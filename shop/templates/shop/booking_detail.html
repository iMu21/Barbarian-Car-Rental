{% extends 'shop/basic.html' %}
{% load static %}
{% block title %}Booking {{ booking.booking_number }}{% endblock %}
{% block body %}

<div class="page-header">
  <div class="container">
    <h1><i class="bi bi-receipt me-2"></i>Booking {{ booking.booking_number }}</h1>
    <p>Created on {{ booking.created_at|date:"F j, Y" }}</p>
  </div>
</div>

<section class="booking-detail-section">
  <div class="container">
    <div class="row g-4">
      <div class="col-lg-8">
        <div class="booking-card">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <h5 class="fw-bold mb-0">{{ booking.car.car_name }}</h5>
            <span class="status-badge status-{{ booking.status }}">{{ booking.get_status_display }}</span>
          </div>

          <div class="row g-3 mb-4">
            <div class="col-md-6">
              <div class="detail-group">
                <span class="detail-label">Customer</span>
                <span class="detail-value">{{ booking.customer_name }}</span>
              </div>
            </div>
            <div class="col-md-6">
              <div class="detail-group">
                <span class="detail-label">Email</span>
                <span class="detail-value">{{ booking.customer_email }}</span>
              </div>
            </div>
            <div class="col-md-6">
              <div class="detail-group">
                <span class="detail-label">Mobile</span>
                <span class="detail-value">{{ booking.customer_mobile }}</span>
              </div>
            </div>
            <div class="col-md-6">
              <div class="detail-group">
                <span class="detail-label">Address</span>
                <span class="detail-value">{{ booking.customer_address }}</span>
              </div>
            </div>
          </div>

          <h6 class="fw-bold mb-3">Rental Details</h6>
          <div class="row g-3 mb-4">
            <div class="col-md-4">
              <div class="detail-group">
                <span class="detail-label">Rental Hours</span>
                <span class="detail-value">{{ booking.rental_hours }} hrs</span>
              </div>
            </div>
            <div class="col-md-4">
              <div class="detail-group">
                <span class="detail-label">Number of Cars</span>
                <span class="detail-value">{{ booking.car_quantity }}</span>
              </div>
            </div>
            <div class="col-md-4">
              <div class="detail-group">
                <span class="detail-label">Driver</span>
                <span class="detail-value">{% if booking.include_driver %}Included{% else %}Not included{% endif %}</span>
              </div>
            </div>
            <div class="col-md-6">
              <div class="detail-group">
                <span class="detail-label">Delivery Date</span>
                <span class="detail-value">{{ booking.delivery_date|date:"F j, Y" }}</span>
              </div>
            </div>
            <div class="col-md-6">
              <div class="detail-group">
                <span class="detail-label">Delivery Time</span>
                <span class="detail-value">{{ booking.delivery_time|time:"g:i A" }}</span>
              </div>
            </div>
          </div>

          <h6 class="fw-bold mb-3">Cost Breakdown</h6>
          <div class="cost-breakdown">
            <div class="cost-row">
              <span>Subtotal ({{ booking.hourly_rate }} BDT/hr x {{ booking.rental_hours }}h x {{ booking.car_quantity }})</span>
              <span>{{ booking.subtotal }} BDT</span>
            </div>
            {% if booking.include_driver %}
            <div class="cost-row">
              <span>Driver Cost ({{ booking.driver_rate }} BDT/hr x {{ booking.rental_hours }}h x {{ booking.car_quantity }})</span>
              <span>{{ booking.driver_cost }} BDT</span>
            </div>
            {% endif %}
            <div class="cost-row">
              <span>Delivery Cost ({{ booking.delivery_rate }} BDT x {{ booking.car_quantity }})</span>
              <span>{{ booking.delivery_cost }} BDT</span>
            </div>
            {% if booking.discount_amount > 0 %}
            <div class="cost-row">
              <span>Discount{% if booking.coupon %} ({{ booking.coupon.code }}){% endif %}</span>
              <span class="text-success">-{{ booking.discount_amount }} BDT</span>
            </div>
            {% endif %}
            <div class="cost-row cost-total">
              <span>Total</span>
              <span>{{ booking.total_cost }} BDT</span>
            </div>
          </div>

          {% if booking.status == 'pending' or booking.status == 'confirmed' %}
          <div class="mt-4">
            <form method="post" action="{% url 'shop:booking_cancel' booking.pk %}" onsubmit="return confirm('Are you sure you want to cancel this booking?')">
              {% csrf_token %}
              <button type="submit" class="btn btn-outline-danger btn-sm">
                <i class="bi bi-x-circle me-1"></i> Cancel Booking
              </button>
            </form>
          </div>
          {% endif %}
        </div>
      </div>
      <div class="col-lg-4">
        <div class="booking-sidebar">
          <img src="/media/{{ booking.car.car_image }}" alt="{{ booking.car.car_name }}" class="img-fluid rounded mb-3">
          <a href="{% url 'shop:product_detail' booking.car.pk %}" class="btn btn-outline-primary btn-sm w-100">View Vehicle</a>
        </div>
      </div>
    </div>
  </div>
</section>

{% endblock %}
